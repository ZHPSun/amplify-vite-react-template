name: Vite React App CI/CD Pipeline

on:
  push:
    branches:
      - main # 仅在 main 分支发生推送时触发
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v2

      # Step 2: Set up Node.js
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: "16" # 可以根据项目需要修改 Node 版本

      # Step 3: Install dependencies
      - name: Install dependencies
        run: npm install

      # Step 4: Build the Vite project
      - name: Build the project
        run: npm run build

      # Step 5: Upload build artifacts to S3
      - name: Upload build artifacts to S3
        uses: jakejarvis/s3-sync-action@v0.5.0
        with:
          source_dir: "./dist" # Vite 打包后的文件目录
          destination_bucket: "vite-react-demo" # 替换为你的 S3 存储桶名称
          region: "us-east-1" # 替换为 S3 存储桶所在区域
          acl: "public-read" # 设置为 public-read 使文件对公众可读


      # Step 6: Invalidate CloudFront cache (可选)
    #   - name: Invalidate CloudFront cache
    #     uses: cheusov/aws-cloudfront-invalidate-action@v1
    #     with:
    #       distribution_id: "YOUR_CLOUDFRONT_DISTRIBUTION_ID" # 替换为你的 CloudFront 分发 ID
    #       paths: "/*" # 可选，设置清除所有缓存
    #     env:
    #       AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }} # 使用 GitHub Secrets 存储 AWS 凭证
    #       AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    #       AWS_REGION: "us-east-1" # 设置为你使用的 AWS 区域
